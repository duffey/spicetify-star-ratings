var starDratings=(()=>{function b(e){Spicetify.showNotification(e)}function t(e,t){Spicetify.LocalStorage.set(e,t)}function v(e){return e.match(/spotify:playlist:(.*)/)[1]}async function g(e,t){e=v(e);await Spicetify.CosmosAsync.del(`https://api.spotify.com/v1/playlists/${e}/tracks`,{tracks:[{uri:t}]})}var h=null;function l(e){return h[e]}function o(e,t){h[e]=t}function U(){try{var e=JSON.parse(Spicetify.LocalStorage.get("starRatings:settings"));throw e&&"object"==typeof e&&(h=e),""}catch(e){t("starRatings:settings","{}"),h={halfStarRatings:!0,likeThreshold:"4.0",hideHearts:!1,enableKeyboardShortcuts:!0,showPlaylistStars:!0}}}function s(){t("starRatings:settings",JSON.stringify(h))}function u(e,t){var i,a,r,n=document.createElement("span"),l="stars-"+e,o=(n.className="stars",n.id=l,n.style.whiteSpace="nowrap",n.style.alignItems="center",n.style.display="flex",[]);for(let e=0;e<5;e++){d=l,i=e+1,c=t,r=a=s=void 0,s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),d=d+"-"+i,a.id=d,a.style.minHeight=c+"px",a.style.minWidth=c+"px",a.setAttributeNS(null,"width",c+"px"),a.setAttributeNS(null,"height",c+"px"),a.setAttributeNS(null,"viewBox","0 0 32 32"),i=document.createElementNS(s,"defs"),a.append(i),c=document.createElementNS(s,"linearGradient"),i.append(c),c.id=d+"-gradient",i=document.createElementNS(s,"stop"),c.append(i),i.id=d+"-gradient-first",i.setAttributeNS(null,"offset","50%"),i.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r=document.createElementNS(s,"stop"),c.append(r),r.id=d+"-gradient-second",r.setAttributeNS(null,"offset","50%"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),d=document.createElementNS(s,"path"),a.append(d),d.setAttributeNS(null,"fill",`url(#${c.id})`),d.setAttributeNS(null,"d","M20.388,10.918L32,12.118l-8.735,7.749L25.914,31.4l-9.893-6.088L6.127,31.4l2.695-11.533L0,12.118l11.547-1.2L16.026,0.6L20.388,10.918z");var[s,c,d]=[a,i,r];n.append(s),o.push([s,c,d])}return[n,o]}function k(t,e){var i=e/=.5;for(let e=0;e<5;e++){var a=t[e][1],r=t[e][2];a.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)")}for(let e=0;e<i;e++){var n=Math.floor(e/2),l=t[n][1],n=t[n][2];(e%2==0?l:n).setAttributeNS(null,"stop-color","var(--spice-button)")}}function w(e,t){e=e.getBoundingClientRect(),e=event.clientX-e.left;let i=t+1;return 8<e||!h.halfStarRatings||(i-=.5),0===t&&e<3&&(i-=h.halfStarRatings?.5:1),i.toFixed(1)}function n({icon:e,size:t}){return Spicetify.React.createElement("svg",{width:t,height:t,viewBox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:e}})}function c({name:e,field:t,onclick:i}){let[a,r]=Spicetify.React.useState(l(t));return Spicetify.React.createElement("div",{className:"popup-row"},Spicetify.React.createElement("label",{className:"col description"},e),Spicetify.React.createElement("div",{className:"col action"},Spicetify.React.createElement("button",{className:"checkbox"+(a?"":" disabled"),onClick:async()=>{var e=!a;o(t,e),r(e),s(),i()}},Spicetify.React.createElement(n,{icon:Spicetify.SVGIcons.check,size:16}))))}function Y({name:e,field:t,options:i,onclick:a}){const[r,n]=Spicetify.React.useState(l(t));return Spicetify.React.createElement("div",{className:"popup-row"},Spicetify.React.createElement("label",{className:"col description"},e),Spicetify.React.createElement("div",{className:"col action"},Spicetify.React.createElement("select",{value:r,onChange:async e=>{n(e.target.value),o(t,e.target.value),s(),a()}},Object.keys(i).map(e=>Spicetify.React.createElement("option",{value:e},i[e])))))}function d(e,t){return Spicetify.React.createElement("li",{className:"main-keyboardShortcutsHelpModal-sectionItem"},Spicetify.React.createElement("span",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-sectionItemName"},e),Spicetify.React.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Ctrl"),Spicetify.React.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Alt"),Spicetify.React.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},t))}async function x(){var e=(await Spicetify.Platform.RootlistAPI.getContents()).items.find(e=>"folder"===e.type&&"Rated"===e.name);return e?[function(e){var t=["0.0","0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"],i={};for(const a of e.items)t.includes(a.name)&&(i[a.name]=a);return i}(e),e.uri]:[[],null]}async function $(){var e,[t,i]=await x(),a={};for(const s in t){e=t[s].uri;for(const c of await(await Spicetify.CosmosAsync.get("sp://core-playlist/v1/playlist/"+e)).items){var r,n,l,o=c.link;a[o]?(n=(r=parseFloat(s))<(l=parseFloat(a[o]))?s:a[o],l=l<r?s:a[o],a[o]=l,console.log(`Removing track ${c.name} with lower rating ${n} and higher rating ${l} from lower rated playlist ${t[n].name}.`),await g(t[n].uri,o)):a[o]=s}}return[t,i,a]}var p,y="[index] 16px [first] 4fr [var1] 2fr [var2] 1fr [last] minmax(120px,1fr)",f="[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] 2fr [last] minmax(120px,1fr)",m="[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] minmax(120px,2fr) [var3] 2fr [last] minmax(120px,1fr)",S=null,E=null,R=null,[N,A,P]=[null,null,null],L=[null][0],K=null,M=null,_=null,T=null,H=null,C=!1;function B(){return document.querySelector(".main-nowPlayingWidget-nowPlaying .control-button-heart")}function I(){return Spicetify.Player.data.track.uri}async function q(){var e;K&&(e=function(e,t){let i=0,a=0;for(const l of t.discs[0].tracks){var r=e[l.uri];r&&(i+=parseFloat(r),a+=1)}let n=0;return 0<a&&(n=i/a),n=(Math.round(2*n)/2).toFixed(1)}(P,K),k(T[1],e.toString()))}function D(c,d,e,p,u,y,f){const[,m]=e,S=m[c][0];return async()=>{if(!C){C=!0;var i=p(),a=P[i]||"0.0";let e=null!==d?d:w(S,c);var r,n=f(),n=(n&&"disabled"!==h.likeThreshold&&("true"!==n.ariaChecked&&e>=parseFloat(h.likeThreshold)&&n.click(),"true"===n.ariaChecked)&&e<parseFloat(h.likeThreshold)&&n.click(),a===e&&P[i]),a=(n&&(e="0.0"),P[i]),l=e.toString(),o=(P[i]=l,k(m,e),a&&(await g(N[a].uri,i),n)&&b("Removed from "+a),N[l]);let t=null;if(o||n||(A||(await Spicetify.Platform.RootlistAPI.createFolder("Rated",{before:""}),[N,A]=await x()),t=(o=l,s=A,await(navigator.platform.startsWith("Linux")&&navigator.userAgent.includes("Spotify/1.1.84.716")?Spicetify.Platform.RootlistAPI.createPlaylist(o,{after:s}):Spicetify.Platform.RootlistAPI.createPlaylist(o,{after:{uri:s}}))),r=t,await!setTimeout(async()=>{await Spicetify.CosmosAsync.post(`sp://core-playlist/v1/playlist/${r}/set-base-permission`,{permission_level:"BLOCKED"})},1e3),[N,A]=await x()),n)delete P[i];else{var o=t=N[l].uri,s=i;o=v(o);try{await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${o}/tracks`,{uris:[s]})}catch(e){await new Promise(e=>setTimeout(e,500)),await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${o}/tracks`,{uris:[s]})}await 0,b((a?"Moved":"Added")+" to "+l),P[i]=l}u&&M&&M(),y&&_&&((n=document.getElementById("stars-"+i))&&n.remove(),await _()),await q(),C=!1}}}function j(i){return()=>{for(var[e,t]of Object.entries(i))Spicetify.Keyboard.registerShortcut({key:t,ctrl:!0,alt:!0},D(0,e,H,I,!1,!0,B))}}function O(e,i,a,r,n){const[t,l]=e;t.addEventListener("mouseout",function(){var e;k(l,(e=i(),P[e]||"0.0"))});for(let t=0;t<5;t++){const o=l[t][0];o.addEventListener("mousemove",function(){var e=w(o,t);k(l,e)}),o.addEventListener("click",D(t,null,e,i,a,r,n))}}var e=async function(){for(;null==Spicetify||!Spicetify.showNotification;)await new Promise(e=>setTimeout(e,100));U(),s(),[N,A,P]=await $();const t={"5.0":Spicetify.Keyboard.KEYS.NUMPAD_0,.5:Spicetify.Keyboard.KEYS.NUMPAD_1,"1.0":Spicetify.Keyboard.KEYS.NUMPAD_2,1.5:Spicetify.Keyboard.KEYS.NUMPAD_3,"2.0":Spicetify.Keyboard.KEYS.NUMPAD_4,2.5:Spicetify.Keyboard.KEYS.NUMPAD_5,"3.0":Spicetify.Keyboard.KEYS.NUMPAD_6,3.5:Spicetify.Keyboard.KEYS.NUMPAD_7,"4.0":Spicetify.Keyboard.KEYS.NUMPAD_8,4.5:Spicetify.Keyboard.KEYS.NUMPAD_9};var i,a,r;new Spicetify.Menu.Item("Star Ratings",!1,(i=j(t),r=t,a=()=>{for(const e of Object.values(r))Spicetify.Keyboard._deregisterShortcut({key:e,ctrl:!0,alt:!0})},()=>{var e=Spicetify.React.createElement("style",null,`.popup-row::after {
                    content: "";
                    display: table;
                    clear: both;
                }
                .popup-row .col {
                    display: flex;
                    padding: 10px 0;
                    align-items: center;
                }
                .popup-row .col.description {
                    float: left;
                    padding-right: 15px;
                }
                .popup-row .col.action {
                    float: right;
                    text-align: right;
                }
                .popup-row .div-title {
                    color: var(--spice-text);
                }
                .popup-row .divider {
                    height: 2px;
                    border-width: 0;
                    background-color: var(--spice-button-disabled);
                }
                .popup-row .space {
                    margin-bottom: 20px;
                    visibility: hidden;
                }
                button.checkbox {
                    align-items: center;
                    border: 0px;
                    border-radius: 50%;
                    background-color: rgba(var(--spice-rgb-shadow), 0.7);
                    color: var(--spice-text);
                    cursor: pointer;
                    display: flex;
                    margin-inline-start: 12px;
                    padding: 8px;
                }
                button.checkbox.disabled {
                    color: rgba(var(--spice-rgb-text), 0.3);
                }
                select {
                    color: var(--spice-text);
                    background: rgba(var(--spice-rgb-shadow), 0.7);
                    border: 0;
                    height: 32px;
                }
                ::-webkit-scrollbar {
                    width: 8px;
                }
                .login-button {
                    background-color: var(--spice-button);
                    border-radius: 8px;
                    border-style: none;
                    box-sizing: border-box;
                    color: var(--spice-text);
                    cursor: pointer;
                    display: inline-block;
                    font-size: 14px;
                    font-weight: 500;
                    height: 40px;
                    line-height: 20px;
                    list-style: none;
                    margin: 10px;
                    outline: none;
                    padding: 5px 10px;
                    position: relative;
                    text-align: center;
                    text-decoration: none;
                    vertical-align: baseline;
                    touch-action: manipulation;
                }`),e=Spicetify.React.createElement("div",null,e,Spicetify.React.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},"Settings"),Spicetify.React.createElement(c,{name:"Half star ratings",field:"halfStarRatings",onclick:async()=>{}}),Spicetify.React.createElement(c,{name:"Hide hearts",field:"hideHearts",onclick:async()=>{var e=document.querySelector(".control-button-heart"),e=(e&&(e.style.display=h.hideHearts?"none":"flex"),document.querySelectorAll(".main-trackList-rowHeartButton"));for(const t of e)t.style.display=h.hideHearts?"none":"flex"}}),Spicetify.React.createElement(c,{name:"Enable keyboard shortcuts",field:"enableKeyboardShortcuts",onclick:async()=>{(h.enableKeyboardShortcuts?i:a)()}}),Spicetify.React.createElement(c,{name:"Show playlist stars",field:"showPlaylistStars",onclick:async()=>{}}),Spicetify.React.createElement(Y,{name:"Auto-like/dislike threshold",field:"likeThreshold",options:{disabled:"Disabled","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"},onclick:async()=>{}}),Spicetify.React.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},"Keyboard Shortcuts"),Spicetify.React.createElement("ul",null,d("Rate current track 0.5 stars","1"),d("Rate current track 1 star","2"),d("Rate current track 1.5 stars","3"),d("Rate current track 2 stars","4"),d("Rate current track 2.5 stars","5"),d("Rate current track 3 stars","6"),d("Rate current track 3.5 stars","7"),d("Rate current track 4 stars","8"),d("Rate current track 4.5 stars","9"),d("Rate current track 5 stars","0")));Spicetify.PopupModal.display({title:"Star Ratings",content:e,isLarge:!0})})).register(),_=()=>{if(h.showPlaylistStars){var e=document.querySelector(".main-trackList-indexable");if(e){var e=e.getElementsByClassName("main-trackList-trackListRow"),t=document.querySelector(".main-trackList-trackListHeaderRow");if(t){var i=t.querySelector(".main-trackList-rowSectionEnd");switch(parseInt(i.getAttribute("aria-colindex"))){case 4:t.style["grid-template-columns"]=y;break;case 5:t.style["grid-template-columns"]=f;break;case 6:t.style["grid-template-columns"]=m}}for(const c of e){var a=()=>c.getElementsByClassName("main-addButton-button")[0],r=c.getElementsByClassName("main-addButton-button")[0],n=0<c.getElementsByClassName("stars").length;o=c,l=void 0;const d=(o=Object.values(o))?(null==(l=null==(l=null==(l=null==(l=null==(l=null==(l=o[0])?void 0:l.pendingProps)?void 0:l.children[0])?void 0:l.props)?void 0:l.children)?void 0:l.props)?void 0:l.uri)||(null==(l=null==(l=null==(l=null==(l=null==(l=null==(l=null==(l=null==(l=o[0])?void 0:l.pendingProps)?void 0:l.children[0])?void 0:l.props)?void 0:l.children)?void 0:l.props)?void 0:l.children)?void 0:l.props)?void 0:l.uri)||(null==(o=null==(l=null==(o=null==(l=null==(o=null==(l=o[0])?void 0:l.pendingProps)?void 0:o.children[0])?void 0:l.props)?void 0:o.children[0])?void 0:l.props)?void 0:o.uri):null;var l=d.includes("track");let e=c.querySelector(".starRatings");if(!e){var o=c.querySelector(".main-trackList-rowSectionEnd"),s=parseInt(o.getAttribute("aria-colindex"));switch(o.setAttribute("aria-colindex",(s+1).toString()),(e=document.createElement("div")).setAttribute("aria-colindex",s.toString()),e.role="gridcell",e.style.display="flex",e.classList.add("main-trackList-rowSectionVariable"),e.classList.add("starRatings"),c.insertBefore(e,o),s){case 4:c.style["grid-template-columns"]=y;break;case 5:c.style["grid-template-columns"]=f;break;case 6:c.style["grid-template-columns"]=m}}if(r&&d&&!n&&l){o=u(d,16);const p=o[0];s=o[1],r=P[d]||"0.0";e.appendChild(p),k(s,r),a().style.display=h.hideHearts?"none":"flex",O(o,()=>d,!0,!1,a),p.style.visibility=P[d]?"visible":"hidden",c.addEventListener("mouseover",()=>{p.style.visibility="visible"}),c.addEventListener("mouseout",()=>{p.style.visibility=P[d]?"visible":"hidden"})}}}}},M=()=>{var e,t;H&&(t=(e=Spicetify.Player.data.track.uri).includes("track"),H[0].style.display=t?"flex":"none",t=P[e]||"0.0",k(H[1],t))};const n=new MutationObserver(()=>{_()});Spicetify.Player.addEventListener("songchange",()=>{M()});var e=async()=>{var e;p=S,(S=document.querySelector(".main-trackList-indexable"))&&!S.isEqualNode(p)&&(K=R=null,p&&n.disconnect(),_(),n.observe(S,{childList:!0,subtree:!0})),B()&&(B().style.display=h.hideHearts?"none":"flex"),p=E,(E=document.querySelector(".main-nowPlayingWidget-nowPlaying .main-trackInfo-container"))&&!E.isEqualNode(p)&&((H=u("now-playing",16))[0].style.marginLeft="8px",H[0].style.marginRight="8px",E.after(H[0]),O(H,I,!1,!0,B),M(),h.enableKeyboardShortcuts)&&j(t)(),p=R,(R=document.querySelector(".main-actionBar-ActionBar .main-playButton-PlayButton"))&&!R.isEqualNode(p)&&(e=Spicetify.Platform.History.location.pathname.match(/album\/(.*)/),L=e?e[1]:null)&&(K=await Spicetify.CosmosAsync.get(`wg://album/v1/album-app/album/${L}/desktop`),T=u("album",32),R.after(T[0]),q())},l=new MutationObserver(e);await e(),l.observe(document.body,{childList:!0,subtree:!0})};(async()=>{await e()})()})();
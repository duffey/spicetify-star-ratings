var starDratings=(()=>{var H=Object.defineProperty,a=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,q=(t,e,r)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,U=(t,e)=>{for(var r in e=e||{})B.call(e,r)&&q(t,r,e[r]);if(a)for(var r of a(e))D.call(e,r)&&q(t,r,e[r]);return t};function F(t){Spicetify.showNotification(t)}function n(t){return Spicetify.LocalStorage.get(t)}function l(t,e){Spicetify.LocalStorage.set(t,e)}async function o(){return Spicetify.Platform.RootlistAPI.getContents()}function Y(t){return t.match(/spotify:playlist:(.*)/)[1]}async function d(t,e){t=Y(t);await Spicetify.CosmosAsync.del(`https://api.spotify.com/v1/playlists/${t}/tracks`,{tracks:[{uri:e}]})}function p(t,e){var r,a,i,n=document.createElement("span"),l="stars-"+t,o=(n.className="stars",n.id=l,n.style.whiteSpace="nowrap",n.style.alignItems="center",n.style.display="flex",[]);for(let t=0;t<5;t++){u=l,r=t+1,c=e,i=a=s=void 0,s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),u=u+"-"+r,a.id=u,a.style.minHeight=c+"px",a.style.minWidth=c+"px",a.setAttributeNS(null,"width",c+"px"),a.setAttributeNS(null,"height",c+"px"),a.setAttributeNS(null,"viewBox","0 0 32 32"),r=document.createElementNS(s,"defs"),a.append(r),c=document.createElementNS(s,"linearGradient"),r.append(c),c.id=u+"-gradient",r=document.createElementNS(s,"stop"),c.append(r),r.id=u+"-gradient-first",r.setAttributeNS(null,"offset","50%"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),i=document.createElementNS(s,"stop"),c.append(i),i.id=u+"-gradient-second",i.setAttributeNS(null,"offset","50%"),i.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),u=document.createElementNS(s,"path"),a.append(u),u.setAttributeNS(null,"fill",`url(#${c.id})`),u.setAttributeNS(null,"d","M20.388,10.918L32,12.118l-8.735,7.749L25.914,31.4l-9.893-6.088L6.127,31.4l2.695-11.533L0,12.118l11.547-1.2L16.026,0.6L20.388,10.918z");var[s,c,u]=[a,r,i];n.append(s),o.push([s,c,u])}return[n,o]}function m(e,t){var r=t/=.5;for(let t=0;t<5;t++){var a=e[t][1],i=e[t][2];a.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),i.setAttributeNS(null,"stop-color","var(--spice-button-disabled)")}for(let t=0;t<r;t++){var n=Math.floor(t/2),l=e[n][1],n=e[n][2];(t%2==0?l:n).setAttributeNS(null,"stop-color","var(--spice-button)")}}function $(t,e,r){e=e.getBoundingClientRect(),e=event.clientX-e.left;let a=r+1;return 8<e||!t.halfStarRatings||(a-=.5),0===r&&e<3&&(a-=t.halfStarRatings?.5:1),a}function f(t){l("starRatings:settings",JSON.stringify(t))}function s(t){l("starRatings:playlistUris",JSON.stringify(t))}function c(t){l("starRatings:ratedFolderUri",t)}var y=Spicetify.React;function G(){return y.createElement("svg",{width:16,height:16,viewbox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:Spicetify.SVGIcons.check}})}function u({settings:e,name:t,field:r,onclick:a}){let[i,n]=Spicetify.React.useState(e[r]);var l=i?"checkbox":"checkbox disabled";return y.createElement("div",{className:"popup-row"},y.createElement("label",{className:"col description"},t),y.createElement("div",{className:"col action"},y.createElement("button",{className:l,onClick:function(){var t=!i;e[r]=t,n(t),f(e),a&&a()}},y.createElement(G,null))))}function J({settings:r,name:t,field:a,options:i,onclick:n}){const[l,o]=Spicetify.React.useState(r[a]);var s,c,u=[];for([s,c]of Object.entries(i))u.push(y.createElement("option",{value:c},s));return y.createElement("div",{className:"popup-row"},y.createElement("label",{className:"col description"},t),y.createElement("div",{className:"col action"},y.createElement("select",{value:l,onChange:function(t){o(e.target.value),r[a]=e.target.value,f(r),n&&n()}},u)))}function b({label:t,numberKey:e}){return y.createElement("li",{className:"main-keyboardShortcutsHelpModal-sectionItem"},y.createElement("span",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-sectionItemName"},t),y.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Ctrl"),y.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Alt"),y.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},e))}function W({value:t}){return y.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},t)}function z({settings:a,registerKeyboardShortcuts:t,deregisterKeyboardShortcuts:e,updateTracklist:r,restoreTracklist:i}){return y.createElement("div",null,y.createElement(W,{value:"Settings"}),y.createElement(u,{settings:a,name:"Half star ratings",field:"halfStarRatings"}),y.createElement(u,{settings:a,name:"Hide hearts",field:"hideHearts",onclick:function(t){var e=document.querySelector(".control-button-heart");e&&(e.style.display=a.hideHearts?"none":"flex");for(const r of e=document.querySelectorAll(".main-trackList-rowHeartButton"))r.style.display=a.hideHearts?"none":"flex"}}),y.createElement(u,{settings:a,name:"Enable keyboard shortcuts",field:"enableKeyboardShortcuts",onclick:function(){(a.enableKeyboardShortcuts?t:e)()}}),y.createElement(u,{settings:a,name:"Show playlist stars",field:"showPlaylistStars",onclick:function(){(a.showPlaylistStars?r:i)()}}),y.createElement(J,{settings:a,name:"Auto-like/dislike threshold",field:"likeThreshold",options:{disabled:"Disabled","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"}}),y.createElement(W,{value:"Keyboard Shortcuts"}),y.createElement("ul",null,y.createElement(b,{label:"Rate current track 0.5 stars",numberKey:"1"}),y.createElement(b,{label:"Rate current track 1 star",numberKey:"2"}),y.createElement(b,{label:"Rate current track 1.5 stars",numberKey:"3"}),y.createElement(b,{label:"Rate current track 2 stars",numberKey:"4"}),y.createElement(b,{label:"Rate current track 2.5 stars",numberKey:"5"}),y.createElement(b,{label:"Rate current track 3 stars",numberKey:"6"}),y.createElement(b,{label:"Rate current track 3.5 stars",numberKey:"7"}),y.createElement(b,{label:"Rate current track 4 stars",numberKey:"8"}),y.createElement(b,{label:"Rate current track 4.5 stars",numberKey:"9"}),y.createElement(b,{label:"Rate current track 5 stars",numberKey:"0"})))}function V(t,e){return t.items.find(t=>"folder"===t.type&&t.name===e)}async function X(e){var r=Object.keys(e),a=await Promise.all(r.map(t=>async function(t){return(await Spicetify.CosmosAsync.get("sp://core-playlist/v1/playlist/"+t)).items}(e[t]))),i={};for(let t=0;t<r.length;t++)i[r[t]]=a[t];return i}async function Q(r,t){const a=[];for(const[i,e]of Object.entries(t))if(!(e.length<=1)){const n=Math.max(...e);e.filter(t=>t!=n).forEach(t=>{var e=r[t];console.log(`Removing track ${i} with lower rating ${t} and higher rating ${n} from lower rated playlist ${e}.`),a.push(d(e,i))})}await Promise.all(a)}var g=null,v=null,h={},S={},k={},w=null,E=null,r=null,i=null,x=null,N=[],R=[],Z=null,A=null,tt=null,K=null,P=null,et=null,L=null,C=null,M=!1,O=!1;function rt(t){return t.match(/spotify:track:(.*)/)[1]}function T(){return document.querySelector(".main-nowPlayingWidget-nowPlaying .control-button-heart")}var at=()=>Spicetify.Player.data.track.uri;function I(){var t;P&&(t=function(t,e){let r=0,a=0;for(const l of e.discs[0].tracks){var i=t[l.uri];i&&(r+=parseFloat(i),a+=1)}let n=0;return 0<a&&(n=r/a),n=(Math.round(2*n)/2).toFixed(1)}(h,et),m(L[1],t.toString()))}async function it(t,e,r){h[t]=r,e&&(i=e.toFixed(1),i=k[i],S[i],await d(i,t)),v||(await Spicetify.Platform.RootlistAPI.createFolder("Rated",{before:""}),i=V(await o(),"Rated"),c(v=i.uri));var a,i=r.toFixed(1);let n=k[i];n||(n=(r=i,l=v,await(navigator.platform.startsWith("Linux")&&navigator.userAgent.includes("Spotify/1.1.84.716")?Spicetify.Platform.RootlistAPI.createPlaylist(r,{after:l}):Spicetify.Platform.RootlistAPI.createPlaylist(r,{after:{uri:l}}))),a=n,await!setTimeout(async()=>{await Spicetify.CosmosAsync.post(`sp://core-playlist/v1/playlist/${a}/set-base-permission`,{permission_level:"BLOCKED"})},1e3),k[i]=n,s(k),S[n]=i);var r=n,l=t;r=Y(r);try{await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${r}/tracks`,{uris:[l]})}catch(t){await new Promise(t=>setTimeout(t,500)),await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${r}/tracks`,{uris:[l]})}await 0,F((e?"Moved":"Added")+" to "+S[n])}function nt(l,o,s,c,u){return()=>{if(!M&&!O){M=!0;var[,a]=s,a=a[l][0];const i=c(),n=h[i];let t=null!==o?o:$(g,a,l);a=u();a&&"disabled"!==g.likeThreshold&&("true"!==a.ariaChecked&&t>=parseFloat(g.likeThreshold)&&a.click(),"true"===a.ariaChecked)&&t<parseFloat(g.likeThreshold)&&a.click();let e=null,r=null;(e=n===t?(r=0,async function(t,e){delete h[t];var e=e.toFixed(1),e=k[e],r=S[e];await d(e,t),F("Removed from "+r)}(i,t)):(r=t,it(i,n,t))).finally(()=>{(tracklistStarData=function(t){var e="stars-"+t;if(!(t=document.getElementById(e)))return null;var r=[];for(let t=1;t<=5;t++){var a=e+"-"+t,i=document.getElementById(a),n=document.getElementById(a+"-gradient-first"),a=document.getElementById(a+"-gradient-second");r.push([i,n,a])}return[t,r]}(rt(i)))&&(m(tracklistStarData[1],r),tracklistStarData[0].style.visibility=n===t?"hidden":"visible"),j(),I(),M=!1})}}}function lt(r){return()=>{for(var[t,e]of Object.entries(r))Spicetify.Keyboard.registerShortcut({key:e,ctrl:!0,alt:!0},nt(0,parseFloat(t),C,at,T))}}function ot(t,r,a){const[e,i]=t;e.addEventListener("mouseout",function(){var t;m(i,(t=r(),null!=(t=h[t])?t:0))});for(let e=0;e<5;e++){const n=i[e][0];n.addEventListener("mousemove",function(){var t=$(g,n,e);m(i,t)}),n.addEventListener("click",nt(e,null,t,r,a))}}function st(){document.querySelectorAll(".main-trackList-trackListHeaderRow").forEach(t=>{t.style["grid-template-columns"]=w});for(const r of N)for(const a of r.getElementsByClassName("main-trackList-trackListRow")){var t,e=a.querySelector(".starRatings");e&&(a.style["grid-template-columns"]=E,e.remove(),e=a.querySelector(".main-trackList-rowSectionEnd"),t=parseInt(e.getAttribute("aria-colindex")),e.setAttribute("aria-colindex",(t-1).toString()))}}function _(){if(g.showPlaylistStars){R=N;let e=(N=Array.from(document.querySelectorAll(".main-trackList-indexable"))).length!==R.length;for(let t=0;t<N.length;t++)N[t].isEqualNode(R[t])||(e=!0);e&&(E=w=null);const s=[null,null,null,null,"[index] 16px [first] 4fr [var1] 2fr [var2] 1fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] 2fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] minmax(120px,2fr) [var3] 2fr [last] minmax(120px,1fr)"];document.querySelectorAll(".main-trackList-trackListHeaderRow").forEach(t=>{var e=t.querySelector(".main-trackList-rowSectionEnd"),e=parseInt(e.getAttribute("aria-colindex"));(w=w||getComputedStyle(t).gridTemplateColumns)&&s[e]&&(t.style["grid-template-columns"]=s[e])});for(const t of N)for(const c of t.getElementsByClassName("main-trackList-trackListRow")){var r=()=>c.getElementsByClassName("main-addButton-button")[0],a=c.getElementsByClassName("main-addButton-button")[0],i=0<c.getElementsByClassName("stars").length;l=c,n=void 0;const u=(l=Object.values(l))?(null==(n=null==(n=null==(n=null==(n=null==(n=null==(n=l[0])?void 0:n.pendingProps)?void 0:n.children[0])?void 0:n.props)?void 0:n.children)?void 0:n.props)?void 0:n.uri)||(null==(n=null==(n=null==(n=null==(n=null==(n=null==(n=null==(n=null==(n=l[0])?void 0:n.pendingProps)?void 0:n.children[0])?void 0:n.props)?void 0:n.children)?void 0:n.props)?void 0:n.children)?void 0:n.props)?void 0:n.uri)||(null==(l=null==(n=null==(l=null==(n=null==(l=null==(n=l[0])?void 0:n.pendingProps)?void 0:l.children[0])?void 0:n.props)?void 0:l.children[0])?void 0:n.props)?void 0:l.uri):null;var n=u.includes("track");let t=c.querySelector(".starRatings");if(t||(l=c.querySelector(".main-trackList-rowSectionEnd"),o=parseInt(l.getAttribute("aria-colindex")),l.setAttribute("aria-colindex",(o+1).toString()),(t=document.createElement("div")).setAttribute("aria-colindex",o.toString()),t.role="gridcell",t.style.display="flex",t.classList.add("main-trackList-rowSectionVariable"),t.classList.add("starRatings"),c.insertBefore(t,l),E=E||getComputedStyle(c).gridTemplateColumns,s[o]&&(c.style["grid-template-columns"]=s[o])),a&&u&&!i&&n){var l=p(rt(u),16);const d=l[0];var o=l[1],i=null!=(a=h[u])?a:0;t.appendChild(d),m(o,i),r().style.display=g.hideHearts?"none":"flex",ot(l,()=>u,r),d.style.visibility=void 0!==h[u]?"visible":"hidden",c.addEventListener("mouseover",()=>{d.style.visibility="visible"}),c.addEventListener("mouseout",()=>{d.style.visibility=void 0!==h[u]?"visible":"hidden"})}}}}async function ct(t){r=i,(i=document.querySelector("main"))&&!i.isEqualNode(r)&&(r&&x.disconnect(),_(),x.observe(i,{childList:!0,subtree:!0})),T()&&(T().style.display=g.hideHearts?"none":"flex"),Z=A,(A=document.querySelector(".main-nowPlayingWidget-nowPlaying .main-trackInfo-container"))&&!A.isEqualNode(Z)&&((C=p("now-playing",16))[0].style.marginLeft="8px",C[0].style.marginRight="8px",A.after(C[0]),ot(C,at,T),j(),g.enableKeyboardShortcuts)&&lt(t)(),tt=K,(K=document.querySelector(".main-actionBar-ActionBar .main-playButton-PlayButton"))&&!K.isEqualNode(tt)&&(L=p("album",32),K.after(L[0]),await ut(),I())}async function ut(){var t;L&&(t=Spicetify.Platform.History.location.pathname.match(/album\/(.*)/),P=t?t[1]:null,L[0].style.display=P?"flex":"none",P)&&(t=P,et=await Spicetify.CosmosAsync.get(`wg://album/v1/album-app/album/${t}/desktop`),I())}function j(){var t,e;C&&(t=(e=Spicetify.Player.data.track.uri).includes("track"),C[0].style.display=t?"flex":"none",e=null!=(t=h[e])?t:0,m(C[1],e))}function dt(t){var t=Spicetify.URI.fromString(t[0]),e=Spicetify.URI["Type"];return t.type===e.FOLDER}async function pt(){v=n("starRatings:ratedFolderUri"),h={},S={},k=function(){try{var t=JSON.parse(n("starRatings:playlistUris"));if(t&&"object"==typeof t)return t;throw""}catch(t){return l("starRatings:playlistUris","{}"),{}}}();let t=null;var e,r,a,i;v?(e=await o(),t=(r=v,e.items.find(t=>"folder"===t.type&&t.uri===r))):(e=await o(),(t=V(e,"Rated"))&&c(v=t.uri)),t?(a=!1,[a,k]=function(t,e){var r={};let a=!1;for(const[i,n]of Object.entries(t))e.items.find(t=>t.uri===n)?r[i]=n:a=!0;return[a,r]}(k,t),i=!1,[i,k]=function(e,t){const r=U({},e);let a=!1;const i=["0.0","0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"].filter(t=>!e.hasOwnProperty(t));return t.items.filter(t=>i.includes(t.name)).forEach(t=>{r[t.name]=t.uri,a=!0}),[a,r]}(k,t),(i||a)&&s(k),i=await X(k),h=function(t){var e,r,a={};for([e,r]of Object.entries(t))for(const n of r){var i=n.link;let t=[];(t=a[i]?a[i]:t).push(e),a[i]=t}return a}(i),await Q(k,h),h=function(t){var e,r,a={};for([e,r]of Object.entries(t))a[e]=Math.max(...r);return a}(h),S=function(e,t){const r={};return t.items.filter(t=>Object.values(e).includes(t.uri)).forEach(t=>{r[t.uri]=t.name}),r}(k,t)):0<Object.keys(k).length&&(s(k={}),c(v=""))}var t=async function(){for(;null==Spicetify||!Spicetify.showNotification;)await new Promise(t=>setTimeout(t,100));f(g=function(){var e={halfStarRatings:!0,likeThreshold:"4.0",hideHearts:!1,enableKeyboardShortcuts:!0,showPlaylistStars:!0};settings={};try{var t=JSON.parse(n("starRatings:settings"));if(!t||"object"!=typeof t)throw"";settings=t}catch(t){return l("starRatings:settings",e),e}let r=!1;for(const a of Object.keys(e))settings.hasOwnProperty(a)||(settings[a]=e[a],r=!0);return r&&l("starRatings:settings",settings),settings}()),await pt();const t={"5.0":Spicetify.Keyboard.KEYS.NUMPAD_0,.5:Spicetify.Keyboard.KEYS.NUMPAD_1,"1.0":Spicetify.Keyboard.KEYS.NUMPAD_2,1.5:Spicetify.Keyboard.KEYS.NUMPAD_3,"2.0":Spicetify.Keyboard.KEYS.NUMPAD_4,2.5:Spicetify.Keyboard.KEYS.NUMPAD_5,"3.0":Spicetify.Keyboard.KEYS.NUMPAD_6,3.5:Spicetify.Keyboard.KEYS.NUMPAD_7,"4.0":Spicetify.Keyboard.KEYS.NUMPAD_8,4.5:Spicetify.Keyboard.KEYS.NUMPAD_9},e=lt(t),r=(a=t,()=>{for(const t of Object.values(a))Spicetify.Keyboard._deregisterShortcut({key:t,ctrl:!0,alt:!0})});new Spicetify.Menu.Item("Star Ratings",!1,()=>{Spicetify.PopupModal.display({title:"Star Ratings",content:z({settings:g,registerKeyboardShortcuts:e,deregisterKeyboardShortcuts:r,updateTracklist:_,restoreTracklist:st}),isLarge:!0})}).register(),x=new MutationObserver(()=>{_()}),Spicetify.Player.addEventListener("songchange",()=>{j()}),Spicetify.Platform.History.listen(async()=>{await ut()}),new Spicetify.ContextMenu.Item("Use as Rated folder",t=>{c(v=t),O=!0,pt().finally(()=>{O=!1})},dt).register();var a,i=new MutationObserver(async()=>{await ct(t)});await ct(t),i.observe(document.body,{childList:!0,subtree:!0})};(async()=>{await t()})()})();(async()=>{var t;document.getElementById("starDratings")||((t=document.createElement("style")).id="starDratings",t.textContent=String.raw`
  .popup-row::after{content:"";display:table;clear:both}.popup-row .col{display:flex;padding:10px 0;align-items:center}.popup-row .col.description{float:left;padding-right:15px}.popup-row .col.action{float:right;text-align:right}.popup-row .div-title{color:var(--spice-text)}.popup-row .divider{height:2px;border-width:0;background-color:var(--spice-button-disabled)}.popup-row .space{margin-bottom:20px;visibility:hidden}button.checkbox{align-items:center;border:0;border-radius:50%;background-color:rgba(var(--spice-rgb-shadow),.7);color:var(--spice-text);cursor:pointer;display:flex;-webkit-margin-start:12px;margin-inline-start:12px;padding:8px}button.checkbox.disabled{color:rgba(var(--spice-rgb-text),.3)}select{color:var(--spice-text);background:rgba(var(--spice-rgb-shadow),.7);border:0;height:32px}::-webkit-scrollbar{width:8px}.login-button{background-color:var(--spice-button);border-radius:8px;border-style:none;box-sizing:border-box;color:var(--spice-text);cursor:pointer;display:inline-block;font-size:14px;font-weight:500;height:40px;line-height:20px;list-style:none;margin:10px;outline:0;padding:5px 10px;position:relative;text-align:center;text-decoration:none;vertical-align:baseline;touch-action:manipulation}
      `.trim(),document.head.appendChild(t))})();
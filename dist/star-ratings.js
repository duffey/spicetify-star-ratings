var starDratings=(()=>{var H=Object.defineProperty,a=Object.getOwnPropertySymbols,B=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable,r=(t,e,i)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,D=(t,e)=>{for(var i in e=e||{})B.call(e,i)&&r(t,i,e[i]);if(a)for(var i of a(e))I.call(e,i)&&r(t,i,e[i]);return t};function d(t){Spicetify.showNotification(t)}function o(t){return Spicetify.LocalStorage.get(t)}function s(t,e){Spicetify.LocalStorage.set(t,e)}async function c(){return Spicetify.Platform.RootlistAPI.getContents()}function u(t){return t.match(/spotify:playlist:(.*)/)[1]}async function p(t,e){t=u(t);await Spicetify.CosmosAsync.del(`https://api.spotify.com/v1/playlists/${t}/tracks`,{tracks:[{uri:e}]})}function y(t){var e="stars-"+t,t=document.getElementById(e);if(!t)return null;var i=[];for(let t=1;t<=5;t++){var a=e+"-"+t,r=document.getElementById(a),n=document.getElementById(a+"-gradient-first"),a=document.getElementById(a+"-gradient-second");i.push([r,n,a])}return[t,i]}function f(t,e){var i,a,r,n=document.createElement("span"),l="stars-"+t,o=(n.className="stars",n.id=l,n.style.whiteSpace="nowrap",n.style.alignItems="center",n.style.display="flex",[]);for(let t=0;t<5;t++){u=l,i=t+1,c=e,r=a=s=void 0,s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),u=u+"-"+i,a.id=u,a.style.minHeight=c+"px",a.style.minWidth=c+"px",a.setAttributeNS(null,"width",c+"px"),a.setAttributeNS(null,"height",c+"px"),a.setAttributeNS(null,"viewBox","0 0 32 32"),i=document.createElementNS(s,"defs"),a.append(i),c=document.createElementNS(s,"linearGradient"),i.append(c),c.id=u+"-gradient",i=document.createElementNS(s,"stop"),c.append(i),i.id=u+"-gradient-first",i.setAttributeNS(null,"offset","50%"),i.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r=document.createElementNS(s,"stop"),c.append(r),r.id=u+"-gradient-second",r.setAttributeNS(null,"offset","50%"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),u=document.createElementNS(s,"path"),a.append(u),u.setAttributeNS(null,"fill",`url(#${c.id})`),u.setAttributeNS(null,"d","M20.388,10.918L32,12.118l-8.735,7.749L25.914,31.4l-9.893-6.088L6.127,31.4l2.695-11.533L0,12.118l11.547-1.2L16.026,0.6L20.388,10.918z");var[s,c,u]=[a,i,r];n.append(s),o.push([s,c,u])}return[n,o]}function m(e,t){var i=t/=.5;for(let t=0;t<5;t++){var a=e[t][1],r=e[t][2];a.setAttributeNS(null,"stop-color","var(--spice-button-disabled)"),r.setAttributeNS(null,"stop-color","var(--spice-button-disabled)")}for(let t=0;t<i;t++){var n=Math.floor(t/2),l=e[n][1],n=e[n][2];(t%2==0?l:n).setAttributeNS(null,"stop-color","var(--spice-button)")}}function b(t,e,i){e=e.getBoundingClientRect(),e=event.clientX-e.left;let a=i+1;return 8<e||!t.halfStarRatings||(a-=.5),0===i&&e<3&&(a-=t.halfStarRatings?.5:1),a}function g(t){s("starRatings:settings",JSON.stringify(t))}function v(t){s("starRatings:playlistUris",JSON.stringify(t))}function q({icon:t,size:e}){return Spicetify.React.createElement("svg",{width:e,height:e,viewBox:"0 0 16 16",fill:"currentColor",dangerouslySetInnerHTML:{__html:t}})}function S({settings:e,name:t,field:i,onclick:a}){let[r,n]=Spicetify.React.useState(e[i]);return Spicetify.React.createElement("div",{className:"popup-row"},Spicetify.React.createElement("label",{className:"col description"},t),Spicetify.React.createElement("div",{className:"col action"},Spicetify.React.createElement("button",{className:"checkbox"+(r?"":" disabled"),onClick:async()=>{var t=!r;e[i]=t,n(t),g(e),a()}},Spicetify.React.createElement(q,{icon:Spicetify.SVGIcons.check,size:16}))))}function U({settings:e,name:t,field:i,options:a,onclick:r}){const[n,l]=Spicetify.React.useState(e[i]);return Spicetify.React.createElement("div",{className:"popup-row"},Spicetify.React.createElement("label",{className:"col description"},t),Spicetify.React.createElement("div",{className:"col action"},Spicetify.React.createElement("select",{value:n,onChange:async t=>{l(t.target.value),e[i]=t.target.value,g(e),r()}},Object.keys(a).map(t=>Spicetify.React.createElement("option",{value:t},a[t])))))}function h(t,e){return Spicetify.React.createElement("li",{className:"main-keyboardShortcutsHelpModal-sectionItem"},Spicetify.React.createElement("span",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-sectionItemName"},t),Spicetify.React.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Ctrl"),Spicetify.React.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},"Alt"),Spicetify.React.createElement("kbd",{className:"Type__TypeElement-goli3j-0 ipKmGr main-keyboardShortcutsHelpModal-key"},e))}function k(t){return t.items.find(t=>"folder"===t.type&&"Rated"===t.name)}async function Y(e){var i=Object.keys(e),a=await Promise.all(i.map(t=>async function(t){return(await Spicetify.CosmosAsync.get("sp://core-playlist/v1/playlist/"+t)).items}(e[t]))),r={};for(let t=0;t<i.length;t++)r[i[t]]=a[t];return r}async function $(i,t){const a=[];for(const[r,e]of Object.entries(t))if(!(e.length<=1)){const n=Math.max(...e);e.filter(t=>t!=n).forEach(t=>{var e=i[t];console.log(`Removing track ${r} with lower rating ${t} and higher rating ${n} from lower rated playlist ${e}.`),a.push(p(e,r))})}await Promise.all(a)}async function F(){await Spicetify.Platform.RootlistAPI.createFolder("Rated",{before:""})}var w=null,x=null,E={},R={},N={},e=null,i=null,n=null,l=null,P=null,A=null,L=null,K=null,M=null,_=null,O=null,j=null,T=!1;function G(t){return t.match(/spotify:track:(.*)/)[1]}function C(){return document.querySelector(".main-nowPlayingWidget-nowPlaying .control-button-heart")}var z=()=>Spicetify.Player.data.track.uri;function J(){var t;L&&(t=function(t,e){let i=0,a=0;for(const l of e.discs[0].tracks){var r=t[l.uri];r&&(i+=parseFloat(r),a+=1)}let n=0;return 0<a&&(n=i/a),n=(Math.round(2*n)/2).toFixed(1)}(E,K),m(_[1],t.toString()))}async function W(t,e,i){E[t]=i,e&&(r=e.toFixed(1),r=N[r],R[r],await p(r,t)),x||(await F(),r=await c(),x=k(r));var a,r=i.toFixed(1);let n=N[r];n||(n=(i=r,l=x.uri,await(navigator.platform.startsWith("Linux")&&navigator.userAgent.includes("Spotify/1.1.84.716")?Spicetify.Platform.RootlistAPI.createPlaylist(i,{after:l}):Spicetify.Platform.RootlistAPI.createPlaylist(i,{after:{uri:l}}))),a=n,await!setTimeout(async()=>{await Spicetify.CosmosAsync.post(`sp://core-playlist/v1/playlist/${a}/set-base-permission`,{permission_level:"BLOCKED"})},1e3),N[r]=n,v(N),R[n]=r);var i=n,l=t;i=u(i);try{await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${i}/tracks`,{uris:[l]})}catch(t){await new Promise(t=>setTimeout(t,500)),await Spicetify.CosmosAsync.post(`https://api.spotify.com/v1/playlists/${i}/tracks`,{uris:[l]})}await 0,d((e?"Moved":"Added")+" to "+R[n])}function V(l,o,s,c,u){return()=>{if(!T){T=!0;var[,i]=s,i=i[l][0];const n=c();var a=E[n],i=null!==o?o:b(w,i,l),r=u();r&&"disabled"!==w.likeThreshold&&("true"!==r.ariaChecked&&i>=parseFloat(w.likeThreshold)&&r.click(),"true"===r.ariaChecked)&&i<parseFloat(w.likeThreshold)&&r.click();let t=null,e=null;(t=a===i?(e=0,async function(t,e){delete E[t];var e=e.toFixed(1),e=N[e],i=R[e];await p(e,t),d("Removed from "+i)}(n,i)):(e=i,W(n,a,i))).finally(()=>{var[,t]=y(G(n)),[,t]=(t&&m(t,e),y("now-playing"));t&&m(t,e),J(),T=!1})}}}function X(i){return()=>{for(var[t,e]of Object.entries(i))Spicetify.Keyboard.registerShortcut({key:e,ctrl:!0,alt:!0},V(0,parseFloat(t),O,z,C))}}function Q(t,i,a){const[e,r]=t;e.addEventListener("mouseout",function(){var t;m(r,(t=i(),null!=(t=E[t])?t:0))});for(let e=0;e<5;e++){const n=r[e][0];n.addEventListener("mousemove",function(){var t=b(w,n,e);m(r,t)}),n.addEventListener("click",V(e,null,t,i,a))}}function Z(){if(w.showPlaylistStars){var t=document.querySelector(".main-trackList-indexable");if(t){var e,t=t.getElementsByClassName("main-trackList-trackListRow"),i=[null,null,null,null,"[index] 16px [first] 4fr [var1] 2fr [var2] 1fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] 2fr [last] minmax(120px,1fr)","[index] 16px [first] 6fr [var1] 4fr [var2] 3fr [var3] minmax(120px,2fr) [var3] 2fr [last] minmax(120px,1fr)"],a=document.querySelector(".main-trackList-trackListHeaderRow");a&&(e=a.querySelector(".main-trackList-rowSectionEnd"),i[e=parseInt(e.getAttribute("aria-colindex"))])&&(a.style["grid-template-columns"]=i[e]);for(const u of t){var r=()=>u.getElementsByClassName("main-addButton-button")[0],n=u.getElementsByClassName("main-addButton-button")[0],l=0<u.getElementsByClassName("stars").length;s=u,o=void 0;const d=(s=Object.values(s))?(null==(o=null==(o=null==(o=null==(o=null==(o=null==(o=s[0])?void 0:o.pendingProps)?void 0:o.children[0])?void 0:o.props)?void 0:o.children)?void 0:o.props)?void 0:o.uri)||(null==(o=null==(o=null==(o=null==(o=null==(o=null==(o=null==(o=null==(o=s[0])?void 0:o.pendingProps)?void 0:o.children[0])?void 0:o.props)?void 0:o.children)?void 0:o.props)?void 0:o.children)?void 0:o.props)?void 0:o.uri)||(null==(s=null==(o=null==(s=null==(o=null==(s=null==(o=s[0])?void 0:o.pendingProps)?void 0:s.children[0])?void 0:o.props)?void 0:s.children[0])?void 0:o.props)?void 0:s.uri):null;var o=d.includes("track");let t=u.querySelector(".starRatings");if(t||(s=u.querySelector(".main-trackList-rowSectionEnd"),c=parseInt(s.getAttribute("aria-colindex")),s.setAttribute("aria-colindex",(c+1).toString()),(t=document.createElement("div")).setAttribute("aria-colindex",c.toString()),t.role="gridcell",t.style.display="flex",t.classList.add("main-trackList-rowSectionVariable"),t.classList.add("starRatings"),u.insertBefore(t,s),i[c]&&(u.style["grid-template-columns"]=i[c])),n&&d&&!l&&o){var s=f(G(d),16);const p=s[0];var c=s[1],l=null!=(n=E[d])?n:0;t.appendChild(p),m(c,l),r().style.display=w.hideHearts?"none":"flex",Q(s,()=>d,r),p.style.visibility=void 0!==E[d]?"visible":"hidden",u.addEventListener("mouseover",()=>{p.style.visibility="visible"}),u.addEventListener("mouseout",()=>{p.style.visibility=void 0!==E[d]?"visible":"hidden"})}}}}}async function tt(t){e=i,(i=document.querySelector(".main-trackList-indexable"))&&!i.isEqualNode(e)&&(e&&j.disconnect(),Z(),j.observe(i,{childList:!0,subtree:!0})),C()&&(C().style.display=w.hideHearts?"none":"flex"),n=l,(l=document.querySelector(".main-nowPlayingWidget-nowPlaying .main-trackInfo-container"))&&!l.isEqualNode(n)&&((O=f("now-playing",16))[0].style.marginLeft="8px",O[0].style.marginRight="8px",l.after(O[0]),Q(O,z,C),M(),w.enableKeyboardShortcuts)&&X(t)(),P=A,(A=document.querySelector(".main-actionBar-ActionBar .main-playButton-PlayButton"))&&!A.isEqualNode(P)&&(t=Spicetify.Platform.History.location.pathname.match(/album\/(.*)/),L=t?t[1]:null)&&(t=L,K=await Spicetify.CosmosAsync.get(`wg://album/v1/album-app/album/${t}/desktop`),_=f("album",32),A.after(_[0]),J())}var t=async function(){for(;null==Spicetify||!Spicetify.showNotification;)await new Promise(t=>setTimeout(t,100));g(w=function(){try{var t=JSON.parse(o("starRatings:settings"));if(t&&"object"==typeof t)return t;throw""}catch(t){return s("starRatings:settings","{}"),{halfStarRatings:!0,likeThreshold:"4.0",hideHearts:!1,enableKeyboardShortcuts:!0,showPlaylistStars:!0}}}());var t,i,e,a,r,n=await c();x=k(n),E={},R={},N=function(){try{var t=JSON.parse(o("starRatings:playlistUris"));if(t&&"object"==typeof t)return t;throw""}catch(t){return s("starRatings:playlistUris","{}"),{}}}(),x?(n=!1,[n,N]=function(t,e){var i={};let a=!1;for(const[r,n]of Object.entries(t))e.items.find(t=>t.uri===n)?i[r]=n:a=!0;return[a,i]}(N,x),t=!1,[t,N]=function(e,t){const i=D({},e);let a=!1;const r=["0.0","0.5","1.0","1.5","2.0","2.5","3.0","3.5","4.0","4.5","5.0"].filter(t=>!e.hasOwnProperty(t));return t.items.filter(t=>r.includes(t.name)).forEach(t=>{i[t.name]=t.uri,a=!0}),[a,i]}(N,x),(t||n)&&v(N),t=await Y(N),E=function(t){var e,i,a={};for([e,i]of Object.entries(t))for(const n of i){var r=n.link;let t=[];(t=a[r]?a[r]:t).push(e),a[r]=t}return a}(t),await $(N,E),E=function(t){var e,i,a={};for([e,i]of Object.entries(t))a[e]=Math.max(...i);return a}(E),R=function(e,t){const i={};return t.items.filter(t=>Object.values(e).includes(t.uri)).forEach(t=>{i[t.uri]=t.name}),i}(N,x)):0<Object.keys(N).length&&v(N={});const l={"5.0":Spicetify.Keyboard.KEYS.NUMPAD_0,.5:Spicetify.Keyboard.KEYS.NUMPAD_1,"1.0":Spicetify.Keyboard.KEYS.NUMPAD_2,1.5:Spicetify.Keyboard.KEYS.NUMPAD_3,"2.0":Spicetify.Keyboard.KEYS.NUMPAD_4,2.5:Spicetify.Keyboard.KEYS.NUMPAD_5,"3.0":Spicetify.Keyboard.KEYS.NUMPAD_6,3.5:Spicetify.Keyboard.KEYS.NUMPAD_7,"4.0":Spicetify.Keyboard.KEYS.NUMPAD_8,4.5:Spicetify.Keyboard.KEYS.NUMPAD_9};new Spicetify.Menu.Item("Star Ratings",!1,(i=w,e=X(l),r=l,a=()=>{for(const t of Object.values(r))Spicetify.Keyboard._deregisterShortcut({key:t,ctrl:!0,alt:!0})},()=>{var t=Spicetify.React.createElement("div",null,Spicetify.React.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},"Settings"),Spicetify.React.createElement(S,{settings:i,name:"Half star ratings",field:"halfStarRatings",onclick:async()=>{}}),Spicetify.React.createElement(S,{settings:i,name:"Hide hearts",field:"hideHearts",onclick:async()=>{var t=document.querySelector(".control-button-heart"),t=(t&&(t.style.display=i.hideHearts?"none":"flex"),document.querySelectorAll(".main-trackList-rowHeartButton"));for(const e of t)e.style.display=i.hideHearts?"none":"flex"}}),Spicetify.React.createElement(S,{settings:i,name:"Enable keyboard shortcuts",field:"enableKeyboardShortcuts",onclick:async()=>{(i.enableKeyboardShortcuts?e:a)()}}),Spicetify.React.createElement(S,{settings:i,name:"Show playlist stars",field:"showPlaylistStars",onclick:async()=>{}}),Spicetify.React.createElement(U,{settings:i,name:"Auto-like/dislike threshold",field:"likeThreshold",options:{disabled:"Disabled","3.0":"3.0",3.5:"3.5","4.0":"4.0",4.5:"4.5","5.0":"5.0"},onclick:async()=>{}}),Spicetify.React.createElement("h2",{className:"Type__TypeElement-goli3j-0 bcTfIx main-keyboardShortcutsHelpModal-sectionHeading"},"Keyboard Shortcuts"),Spicetify.React.createElement("ul",null,h("Rate current track 0.5 stars","1"),h("Rate current track 1 star","2"),h("Rate current track 1.5 stars","3"),h("Rate current track 2 stars","4"),h("Rate current track 2.5 stars","5"),h("Rate current track 3 stars","6"),h("Rate current track 3.5 stars","7"),h("Rate current track 4 stars","8"),h("Rate current track 4.5 stars","9"),h("Rate current track 5 stars","0")));Spicetify.PopupModal.display({title:"Star Ratings",content:t,isLarge:!0})})).register(),M=()=>{var t,e;O&&(t=(e=Spicetify.Player.data.track.uri).includes("track"),O[0].style.display=t?"flex":"none",e=null!=(t=E[e])?t:0,m(O[1],e))},j=new MutationObserver(()=>{Z()}),Spicetify.Player.addEventListener("songchange",()=>{M()}),n=new MutationObserver(async()=>{await tt(l)}),await tt(l),n.observe(document.body,{childList:!0,subtree:!0})};(async()=>{await t()})()})();(async()=>{var t;document.getElementById("starDratings")||((t=document.createElement("style")).id="starDratings",t.textContent=String.raw`
  .popup-row::after{content:"";display:table;clear:both}.popup-row .col{display:flex;padding:10px 0;align-items:center}.popup-row .col.description{float:left;padding-right:15px}.popup-row .col.action{float:right;text-align:right}.popup-row .div-title{color:var(--spice-text)}.popup-row .divider{height:2px;border-width:0;background-color:var(--spice-button-disabled)}.popup-row .space{margin-bottom:20px;visibility:hidden}button.checkbox{align-items:center;border:0;border-radius:50%;background-color:rgba(var(--spice-rgb-shadow),.7);color:var(--spice-text);cursor:pointer;display:flex;-webkit-margin-start:12px;margin-inline-start:12px;padding:8px}button.checkbox.disabled{color:rgba(var(--spice-rgb-text),.3)}select{color:var(--spice-text);background:rgba(var(--spice-rgb-shadow),.7);border:0;height:32px}::-webkit-scrollbar{width:8px}.login-button{background-color:var(--spice-button);border-radius:8px;border-style:none;box-sizing:border-box;color:var(--spice-text);cursor:pointer;display:inline-block;font-size:14px;font-weight:500;height:40px;line-height:20px;list-style:none;margin:10px;outline:0;padding:5px 10px;position:relative;text-align:center;text-decoration:none;vertical-align:baseline;touch-action:manipulation}
      `.trim(),document.head.appendChild(t))})();